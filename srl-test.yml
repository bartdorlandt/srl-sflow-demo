# Based on https://blog.sflow.com/2021/04/containerlab.html

name: srl-test
mgmt:
  network: clab # Use the standard containerlab mgmt network, but with static IPs
  ipv4_subnet: 172.100.100.0/24
  ipv6_subnet: 2001:172:100:100::/64
topology:
  kinds:
    srl:
      type: ixr6 # See https://www.nokia.com/networks/products/7250-interconnect-router/
      image: registry.srlinux.dev/pub/srlinux # latest, or srlinux:21.3.1-410
      license: ../license.key
  nodes:
    leaf1:
      kind: srl
      config: leaf1.cfg.json
    leaf2:
      kind: srl
      config: leaf2.cfg.json
    spine1:
      kind: srl
      config: spine1.cfg.json
    spine2:
      kind: srl
      config: spine2.cfg.json
 
    h1:
      kind: linux
      image: alpine:latest # or frrouting/frr:latest
    h2:
      kind: linux
      image: alpine:latest
    sflow-collector: # Added, connect via mgmt network
      kind: linux
      image: sflow/prometheus
      mgmt_ipv4: 172.100.100.10 # Pick a fixed IP
      mgmt_ipv6: 2001:172:100:100::10
    # note, that the bridge br-sflow must be created manually on Linux host
    # sudo ip link add br-sflow type bridge
    br-sflow:
      kind: bridge
  links: 
    - endpoints: ["leaf1:e1-1","spine1:e1-1"]
    - endpoints: ["leaf1:e1-2","spine2:e1-1"]
    - endpoints: ["leaf2:e1-1","spine1:e1-2"]
    - endpoints: ["leaf2:e1-2","spine2:e1-2"]
    - endpoints: ["h1:eth1","leaf1:e1-3"]
    - endpoints: ["h2:eth1","leaf2:e1-3"]
    # Connect to sFlow connector via spine1, requires routing on host 192.168.0.0/16 via Spine1
    - endpoints: ["spine1:e1-3","br-sflow:eth1"]
